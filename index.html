<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">


    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id"
        content="947574028688-0u88718tvb88q1s8p588vjst86cudtgp.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js"></script>

    <script src="js/sweet_alert.min.js"></script>

    <!-- Title Page-->
    <title>KCT - Bank DETAILS</title>

    <!-- Icons font CSS-->
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link
        href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/main.css" rel="stylesheet" media="all">
</head>

<body>
    <div class="page-wrapper bg-gra-02 p-t-130 p-b-100 font-poppins">
        <div class="wrapper wrapper--w680">
            <div class="card card-4">
                <div class="card-body">
                    <center>

                        <img src="https://www.logolynx.com/images/logolynx/ea/ea9be493fa78063f39089547ce808b17.png"
                            alt="KCT" width="150" height="150">
                        <h1 class="title">KCT - BANK DETAILS<br>REFUND</h1>
                        <div class="g-signin2" id="sign-in-box" data-onsuccess="onSignIn" data-theme="dark"></div>
                    </center>

                    <form method="POST" id="form" style="display: none;">
                        <div class="row row-space">
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Name</label>
                                    <input class="input--style-4" type="text" name="Name" id="Name" required>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Roll Number</label>
                                    <input class="input--style-4" type="text" name="Roll_Number" id="Roll_Number"
                                        required>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="label">Account Holder Name</label>
                            <input class="input--style-4" type="text" name="Account_Holder_Name"
                                id="Account_Holder_Name" required>
                        </div>
                        <div class="input-group">
                            <label class="label">Account No.</label>
                            <input class="input--style-4" type="text" name="Account_No" id="Account_No" required>
                        </div>
                        <div class="input-group">
                            <label class="label">IFSC Code</label>
                            <input class="input--style-4" type="text" name="IFSC_Code" id="IFSC_Code"
                                onchange=getBranchDetails() required>
                            <span class="help-block">Enter IFSC and Check if Bank and Branch are showing correct.</span>
                        </div>
                        <div class="row row-space">
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Bank</label>
                                    <input class="input--style-4" type="text" name="bank" id="bank" required>
                                </div>
                            </div>
                            <div class="col-2">
                                <div class="input-group">
                                    <label class="label">Branch</label>
                                    <input class="input--style-4" type="text" name="Branch" id="Branch" required>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">

                            <input class="input--style-4" type="text" name="email" id="email" readonly>
                        </div>
                        <center>
                            <div class="">
                                <button class="btn btn--radius-2 btn--blue" id="submit" type="submit">Submit</button>
                            </div>
                        </center>
                    </form>



                    <script>
                        const scriptURL = 'https://script.google.com/macros/s/AKfycby4uZoYgKstmW5oLgPwUVRkKYCn1QijnULKWdreoY5t6SwHT3s/exec'
                        window.addEventListener('DOMContentLoaded', () => {

                            const form = document.getElementById("form")

                            form.addEventListener('submit', e => {
                                e.preventDefault()
                                const button_element = document.getElementById("submit")
                                button_element.disabled = true
                                button_element.textContent = "Submitting..."
                                fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                                    .then(response => {
                                        button_element.classList.remove('btn-primary')
                                        button_element.classList.add('btn-success')
                                        button_element.textContent = "Done!"
                                        if (response.status == 200) {
                                            console.log('Success!', response)
                                            swal("Good job!", "Your response has been recorded!", "success")
                                                .then((value) => {
                                                    google.accounts.id.disableAutoSelect();
                                                    location.reload();

                                                });

                                            // swal("Good job!", "Your response has been recorded!", "success");
                                            document.getElementById("form").reset();
                                            // location.reload();
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error!', error.message)
                                        button_element.classList.remove('btn-primary')
                                        button_element.classList.add('btn-danger')
                                        button_element.textContent = "Sorry"
                                        swal('oh noes!', 'Error submitting data.Please try again later.', 'error')
                                    })
                            })
                        })

                    </script>







                </div>
            </div>
        </div>
    </div>

    <!-- Jquery JS-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <!-- Vendor JS-->
    <script src="vendor/select2/select2.min.js"></script>
    <script src="vendor/datepicker/moment.min.js"></script>
    <script src="vendor/datepicker/daterangepicker.js"></script>

    <!-- Main JS-->
    <script src="js/global.js"></script>
    <script>
        let GoogleAuth = null

        gapi.load('auth2', async () => {
            GoogleAuth = await gapi.auth2.init({
                client_id: '947574028688-0u88718tvb88q1s8p588vjst86cudtgp.apps.googleusercontent.com'
            })
        });
        let email = null;
        function onSignIn(googleUser) {

            let profile = googleUser.getBasicProfile();
            email = profile.getEmail();

            if (email.includes('kct.ac.in') || email.includes('kclas.ac.in')) {
                document.getElementById('sign-in-box').style.display = 'none';
                document.getElementById('form').style.display = 'block';
                document.getElementById('email').value = email;
            }
            else {
                gapi.auth2.getAuthInstance().signOut()
                swal('oh noes!', 'Use official KI college email to login.', 'error')
                // alert('Use official college email to login.')
            }
        }
        const getBranchDetails = async () => {
            const ifsc_code = document.getElementById('IFSC_Code').value;
            const url = 'https://ifsc.razorpay.com/';
            let resp = await fetch(url + ifsc_code);
            if (resp.status === 404) {
                swal('oh noes!', 'Enter a valid IFSC code', 'error')
                document.getElementById("IFSC_Code").value = "";
                document.getElementById("bank").value = "";
                document.getElementById("Branch").value = "";
                // alert('Enter a valid IFSC code')
            } else {
                let data = await resp.json();
                document.getElementById('Branch').value = data.BRANCH;
                document.getElementById('bank').value = data.BANK;
            }

        }
    </script>

</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->